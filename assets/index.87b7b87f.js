import{D as X,u as J,c as q,r as g,d as r,o as w,i as I,g as m,n as L,h as D,l as d,j as M,R as Z,f as Y,k as b,B as V,F as ee,y as te,C as N,t as Q,b as O,w as ae,E as oe,a as K,G as le}from"./vendor.18ce0550.js";import{_ as W}from"./index.7ac2f825.js";const i=new X("myDatabase");i.version("1.0").stores({timeRecord:"++id,date,time",tempTimeRecord:"++id,date,time"}).upgrade(F=>{});const re={class:"history_wrap"},ne={class:"history_header"},se={id:"history"},ie={key:0,class:"content_loop_wrap"},de={key:1,class:"no_content_wrap"},ue={__name:"HistoryList",props:{formatTime:Function,runState:Number},setup(F,{expose:P}){const{useToken:U}=Q,{token:C}=U(),{t:l}=J(),c=F,p=q(()=>[{label:l("app.7daysAgo"),value:[r().add(-7,"d"),r()]},{label:l("app.14daysAgo"),value:[r().add(-14,"d"),r()]},{label:l("app.30daysAgo"),value:[r().add(-30,"d"),r()]},{label:l("app.90daysAgo"),value:[r().add(-90,"d"),r()]}]),o=g({date:[r().add(-30,"d"),r()]}),v=g([]),z=q(()=>[0,2].includes(c.runState)),A=(a,u)=>r(a).format(u),S=a=>r(new Date(a)).format("YYYY/MM/DD")===r().format("YYYY/MM/DD")&&[0,2].includes(c.runState),$=()=>{let a=o.value.date;const u=r(a[0]).startOf("day").toDate(),n=r(a[1]).endOf("day").toDate();i.timeRecord.where("date").between(u,n).toArray().then(f=>{if(f.length==0){v.value=[];return}f.forEach(h=>h.date=h.date.toLocaleString()),v.value=f.reverse()}).catch(f=>{v.value=[],console.error("\u83B7\u5F97\u6570\u636E\u51FA\u9519",f)})},E=()=>{confirm(l("app.confirmDeleteAll"))!==!1&&i.timeRecord.clear().then(()=>{$()}).catch(a=>{console.error(l("app.deleteFailed"),a)})},k=async()=>{let a=o.value.date;const u=a[1].add(1,"days").format("YYYY-MM-DD");let n={};v.value.forEach(y=>{let T=r(y.date).format("YYYY-MM-DD");n[T]=(y.time/1e3/3600).toFixed(2)}),(await i.tempTimeRecord.toArray()).forEach(y=>{let T=r(y.date).format("YYYY-MM-DD");if(!n[T]){let H=y.time.split(":").map(x=>Number(x));n[T]=(H[0]+H[1]/60).toFixed(3)}});let h="";for(let y=a[0];y.format("YYYY-MM-DD")!=u;){let T=y.format("YYYY-MM-DD");n[T]?h+=n[T]+`\r
`:h+=`0\r
`,y=y.add(1,"days")}console.log(h)},G=a=>{confirm(`${l("app.confirmDelete")}${a.date},${l("app.duration")}${c.formatTime(a.time)}${l("app.record")} \uFF1F`)!==!1&&i.timeRecord.delete(a.id).then(()=>{$()}).catch(u=>{alert(l("app.deleteFailed"),u)})};return P({getData:$,historyRecords:v}),(a,u)=>(w(),I("section",re,[m("header",ne,[m("div",{style:L({color:D(C).colorText})},d(a.$t("app.history")),5),m("div",null,[M(D(Z),{presets:p.value,value:o.value.date,"onUpdate:value":u[0]||(u[0]=n=>o.value.date=n),onChange:$,allowClear:!1,size:"large"},null,8,["presets","value"]),M(D(V),{class:"timer_btn",size:"large",onClick:E},{default:Y(()=>[b(d(a.$t("app.reset")),1)]),_:1}),M(D(V),{class:"timer_btn",size:"large",onClick:k},{default:Y(()=>[b(d(a.$t("app.print")),1)]),_:1})])]),u[1]||(u[1]=m("hr",{class:"history_hr"},null,-1)),m("div",se,[v.value.length!==0?(w(),I("div",ie,[(w(!0),I(ee,null,te(v.value,(n,f)=>(w(),I("div",{key:f,class:"content_wrap"},[m("div",{class:"date",style:L({color:D(C).colorText})},d(A(new Date(n.date),"YYYY/MM/DD hh:mm:ss")),5),m("div",{class:"studio_time",style:L({color:D(C).colorTextSecondary})},d(F.formatTime(n.time)),5),M(D(V),{disabled:S(n.date)==!1,size:"small",style:{"margin-left":"10px"},onClick:h=>a.$emit("continue",n,f)},{default:Y(()=>[b(d(a.$t("app.continue")),1)]),_:1},8,["disabled","onClick"]),z.value?(w(),O(D(V),{key:0,size:"small",style:{"margin-left":"10px"},onClick:h=>G(n)},{default:Y(()=>[b(d(a.$t("app.delete")),1)]),_:1},8,["onClick"])):N("",!0)]))),128))])):N("",!0),v.value.length==0?(w(),I("div",de,d(a.$t("app.noData")),1)):N("",!0)])]))}},ce=W(ue,[["__scopeId","data-v-7adefdac"]]);const me={class:"timer_wrap"},pe={class:"timer_header"},ve={class:"timer-btn-list"},fe={__name:"index",setup(F,{expose:P}){const{useToken:U}=Q,{token:C}=U(),{t:l}=J(),c=g(null),p=g(0),o=g(0),v=g("00:00:00"),z=g(null),A=g(0),S=g(-1),$=g(null),E=q(()=>{let e={text:"",color:""};return[0,2].includes(o.value)?(e.text=o.value==2?l("app.paused"):l("app.notStarted"),e.color="success"):(e.text=l("app.running"),e.color="gold"),e}),k=g(null),G=()=>{window.addRecord=function(e){if(isNaN(new Date(e))||typeof e!="string")return alert("date\u5FC5\u987B\u662F\u683C\u5F0F\u5316\u65E5\u671F\u5B57\u7B26\u4E32\uFF0C\u5982"+r(new Date).format("YYYY-MM-DD 23:30:00"));let t=window.prompt(`\u8BF7\u8F93\u5165 ${e} \u5BF9\u5E94\u7684\u5206\u949F\u6570`);if(!/\d*/.test(t))return alert("time\u5FC5\u987B\u6570\u5206\u949F\u6570\uFF08\u53EA\u542B\u6570\u5B57\uFF09");!confirm(`\u65E5\u671F ${e}\uFF0C\u5206\u949F\u6570:${t} ,\u662F\u5426\u786E\u8BA4\u6DFB\u52A0?`)||i.timeRecord.add({date:new Date(e),time:t*60*1e3}).then(()=>{k.value.getData()}).catch(()=>{alert("\u6DFB\u52A0\u5931\u8D25")})}.bind(this),console.log('\u624B\u52A8\u52A0\u8BB0\u5F55\u65B9\u6CD5 addRecord("'+r().format("YYYY-MM-DD 23:30:00")+'")'),window.getTemp=function(){i.tempTimeRecord.toArray().then(e=>console.log(e.reverse()))},console.log("\u83B7\u5F97\u4E34\u65F6\u6570\u636E getTemp()"),window.addBatchTimeData=function(e){function t(s){return Object.prototype.toString.call(s).slice(8,-1).toLowerCase()}if(confirm("\u6DFB\u52A0\u662F\u5426\u6570\u636E\uFF1F")!==!1){console.log(e);for(let s of e){if(t(s.date)!=="date")return console.log("date\u6570\u636E\u4E0D\u5408\u89C4",s),alert("date\u6570\u636E\u4E0D\u5408\u89C4",s);if(t(s.time)!=="number")return console.log("time\u6570\u636E\u4E0D\u5408\u89C4",s),alert("time\u6570\u636E\u4E0D\u5408\u89C4",s)}i.timeRecord.bulkPut(e).then(()=>{alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")}).catch(s=>{console.error("\u65E0\u6CD5\u6DFB\u52A0\u6570\u636E:",s),alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")})}}},a=()=>{$.value=setInterval(()=>{n()},1e3*60*5)},u=()=>{n(),clearInterval($.value),$.value=null},n=async()=>{let e=p.value;if(o.value===1&&(e+=performance.now()-c.value),e<60*1e3)return;let t={date:new Date().toLocaleString(),time:j(Math.floor(e))};if(S.value!=-1){i.tempTimeRecord.update(S.value,t).then(()=>{}).catch(s=>{console.error("\u6570\u636E\u66F4\u65B0\u5931\u8D25:",s)});return}i.tempTimeRecord.add(t).then(async s=>{S.value=s;try{let _=await i.tempTimeRecord.count(),B=localStorage.getItem("tempTimeLength");B=Number(B)||100;let R=await i.tempTimeRecord.orderBy("id").limit(_-B).primaryKeys();if(R.length===0)return;await i.tempTimeRecord.bulkDelete(R)}catch(_){console.log(_),alert("\u5220\u9664\u81EA\u52A8\u4FDD\u5B58\u4E34\u65F6\u6570\u636E\u5931\u8D25")}}).catch(()=>{alert("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25")})},f=e=>{confirm(l("app.confirmContinue"))!==!1&&(k.value.historyRecords.splice(e.oIdx,1),p.value+=e.time,c.value=performance.now(),i.timeRecord.delete(e.id).then(()=>{k.value.getData()}).catch(t=>{alert(l("app.deleteFailed")+t)}),x())},h=()=>{confirm(l("app.confirmAddTime"))!==!1&&(c.value=performance.now(),p.value+=A.value*1e3*60,p.value=Math.max(0,p.value),x(),A.value=0,le.success(l("app.addSuccess")))},y=()=>{c.value=performance.now(),x(),z.value=setInterval(x,1e3),o.value=1},T=()=>{p.value+=performance.now()-c.value,c.value=performance.now(),o.value=2,x(),clearInterval(z.value)},H=()=>{clearInterval(z.value),o.value===1&&(p.value+=performance.now()-c.value),i.timeRecord.add({date:new Date,time:Math.floor(p.value)}).then(()=>{c.value=null,v.value="00:00:00",p.value=0,o.value=0,S.value=-1,k.value.getData()}).catch(()=>{alert(l("app.addFailed"))})},x=()=>{v.value=j(performance.now()-c.value+p.value)},j=e=>{e=Math.floor(Math.floor(e)/1e3);const t=Math.floor(e/3600).toString().padStart(2,"0"),s=Math.floor(e%3600/60).toString().padStart(2,"0"),_=(e%60).toString().padStart(2,"0");return`${t}:${s}:${_}`};return ae(o,e=>{e===1?a():u()}),oe(()=>{S.value=-1,k.value.getData(),G()}),P({formatTime:j,continueTime:f}),(e,t)=>{const s=K("AntTag"),_=K("AntButton"),B=K("AntInputNumber");return w(),I("div",null,[m("section",me,[m("header",pe,[m("span",{style:L({color:D(C).colorText})},d(e.$t("app.timer")),5),[0,1,2].includes(o.value)?(w(),O(s,{key:0,bordered:!1,class:"timer_tag",color:E.value.color},{default:Y(()=>[b(d(E.value.text),1)]),_:1},8,["color"])):N("",!0)]),t[5]||(t[5]=m("hr",{class:"timer_hr"},null,-1)),m("div",{class:"timer_show",style:L({color:D(C).colorText})},d(v.value),5),m("div",ve,[M(_,{disabled:!(o.value==0||o.value==2),class:"start",size:"large",type:"primary",onClick:t[0]||(t[0]=R=>y())},{default:Y(()=>[b(d(e.$t("app.start")),1)]),_:1},8,["disabled"]),M(_,{disabled:o.value!=1,class:"pause",size:"large",type:"primary",onClick:t[1]||(t[1]=R=>T())},{default:Y(()=>[b(d(e.$t("app.pause")),1)]),_:1},8,["disabled"]),M(_,{disabled:!(o.value==1||o.value==2),class:"stop",danger:"",size:"large",onClick:t[2]||(t[2]=R=>H())},{default:Y(()=>[b(d(e.$t("app.stop")),1)]),_:1},8,["disabled"]),o.value==2?(w(),O(B,{key:0,style:{width:"120px","margin-left":"30px"},size:"large",type:"number",class:"common_input",value:A.value,"onUpdate:value":t[3]||(t[3]=R=>A.value=R)},null,8,["value"])):N("",!0),o.value==2?(w(),O(_,{key:1,class:"",size:"large",onClick:t[4]||(t[4]=R=>h())},{default:Y(()=>[b(d(e.$t("app.addTime")),1)]),_:1})):N("",!0)])]),M(ce,{ref_key:"historyListRef",ref:k,formatTime:j,runState:o.value,onContinue:f},null,8,["runState"])])}}},he=W(fe,[["__scopeId","data-v-3482add9"]]);export{he as default};
