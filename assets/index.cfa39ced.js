import{D as W,u as q,c as G,r as h,d as s,o as D,i as I,g as p,n as L,h as i,l as u,j as k,R as X,f as T,k as Y,B as R,F as Z,y as ee,C as A,t as J,b as E,w as te,E as ae,G as oe,H as le,I as re}from"./vendor.b873ea6d.js";import{_ as Q}from"./index.6df7b8d7.js";const d=new W("myDatabase");d.version("1.0").stores({timeRecord:"++id,date,time",tempTimeRecord:"++id,date,time"}).upgrade(F=>{});const se={class:"history_wrap"},ne={class:"history_header"},ie={id:"history"},de={key:0,class:"content_loop_wrap"},ue={key:1,class:"no_content_wrap"},ce={__name:"HistoryList",props:{formatTime:Function,runState:Number},setup(F,{expose:V}){const{useToken:O}=J,{token:x}=O(),{t:r}=q(),m=F,v=G(()=>[{label:r("app.7daysAgo"),value:[s().add(-7,"d"),s()]},{label:r("app.14daysAgo"),value:[s().add(-14,"d"),s()]},{label:r("app.30daysAgo"),value:[s().add(-30,"d"),s()]},{label:r("app.90daysAgo"),value:[s().add(-90,"d"),s()]}]),o=h({date:[s().add(-30,"d"),s()]}),f=h([]),z=G(()=>[0,2].includes(m.runState)),C=(a,c)=>s(a).format(c),M=a=>s(new Date(a)).format("YYYY/MM/DD")===s().format("YYYY/MM/DD")&&[0,2].includes(m.runState),$=()=>{let a=o.value.date;const c=s(a[0]).startOf("day").toDate(),n=s(a[1]).endOf("day").toDate();d.timeRecord.where("date").between(c,n).toArray().then(y=>{if(y.length==0){f.value=[];return}y.forEach(_=>_.date=_.date.toLocaleString()),f.value=y.reverse()}).catch(y=>{f.value=[],console.error("\u83B7\u5F97\u6570\u636E\u51FA\u9519",y)})},B=()=>{confirm(r("app.confirmDeleteAll"))!==!1&&d.timeRecord.clear().then(()=>{$()}).catch(a=>{console.error(r("app.deleteFailed"),a)})},b=async()=>{let a=o.value.date;const c=a[1].add(1,"days").format("YYYY-MM-DD");let n={};f.value.forEach(g=>{let w=s(g.date).format("YYYY-MM-DD");n[w]=(g.time/1e3/3600).toFixed(2)}),(await d.tempTimeRecord.toArray()).forEach(g=>{let w=s(g.date).format("YYYY-MM-DD");if(!n[w]){let H=g.time.split(":").map(S=>Number(S));n[w]=(H[0]+H[1]/60).toFixed(3)}});let _="";for(let g=a[0];g.format("YYYY-MM-DD")!=c;){let w=g.format("YYYY-MM-DD");n[w]?_+=n[w]+`\r
`:_+=`0\r
`,g=g.add(1,"days")}console.log(_)},P=a=>{confirm(`${r("app.confirmDelete")}${a.date},${r("app.duration")}${m.formatTime(a.time)}${r("app.record")} \uFF1F`)!==!1&&d.timeRecord.delete(a.id).then(()=>{$()}).catch(c=>{alert(r("app.deleteFailed"),c)})};return V({getData:$,historyRecords:f}),(a,c)=>(D(),I("section",se,[p("header",ne,[p("div",{style:L({color:i(x).colorText})},u(a.$t("app.history")),5),p("div",null,[k(i(X),{presets:v.value,value:o.value.date,"onUpdate:value":c[0]||(c[0]=n=>o.value.date=n),onChange:$,allowClear:!1,size:"large"},null,8,["presets","value"]),k(i(R),{class:"timer_btn",size:"large",onClick:B},{default:T(()=>[Y(u(a.$t("app.reset")),1)]),_:1}),k(i(R),{class:"timer_btn",size:"large",onClick:b},{default:T(()=>[Y(u(a.$t("app.print")),1)]),_:1})])]),c[1]||(c[1]=p("hr",{class:"history_hr"},null,-1)),p("div",ie,[f.value.length!==0?(D(),I("div",de,[(D(!0),I(Z,null,ee(f.value,(n,y)=>(D(),I("div",{key:y,class:"content_wrap"},[p("div",{class:"date",style:L({color:i(x).colorText})},u(C(new Date(n.date),"YYYY/MM/DD hh:mm:ss")),5),p("div",{class:"studio_time",style:L({color:i(x).colorTextSecondary})},u(F.formatTime(n.time)),5),k(i(R),{disabled:M(n.date)==!1,size:"small",style:{"margin-left":"10px"},onClick:_=>a.$emit("continue",n,y)},{default:T(()=>[Y(u(a.$t("app.continue")),1)]),_:1},8,["disabled","onClick"]),z.value?(D(),E(i(R),{key:0,size:"small",style:{"margin-left":"10px"},onClick:_=>P(n)},{default:T(()=>[Y(u(a.$t("app.delete")),1)]),_:1},8,["onClick"])):A("",!0)]))),128))])):A("",!0),f.value.length==0?(D(),I("div",ue,u(a.$t("app.noData")),1)):A("",!0)])]))}},me=Q(ce,[["__scopeId","data-v-7adefdac"]]);const pe={class:"timer_wrap"},ve={class:"timer_header"},fe={class:"timer-btn-list"},ye={__name:"index",setup(F,{expose:V}){const{useToken:O}=J,{token:x}=O(),{t:r}=q(),m=h(null),v=h(0),o=h(0),f=h("00:00:00"),z=h(null),C=h(0),M=h(-1),$=h(null),B=G(()=>{let e={text:"",color:""};return[0,2].includes(o.value)?(e.text=o.value==2?r("app.paused"):r("app.notStarted"),e.color="success"):(e.text=r("app.running"),e.color="gold"),e}),b=h(null),P=()=>{window.addRecord=function(e){if(isNaN(new Date(e))||typeof e!="string")return alert("date\u5FC5\u987B\u662F\u683C\u5F0F\u5316\u65E5\u671F\u5B57\u7B26\u4E32\uFF0C\u5982"+s(new Date).format("YYYY-MM-DD 23:30:00"));let t=window.prompt(`\u8BF7\u8F93\u5165 ${e} \u5BF9\u5E94\u7684\u5206\u949F\u6570`);if(!/\d*/.test(t))return alert("time\u5FC5\u987B\u6570\u5206\u949F\u6570\uFF08\u53EA\u542B\u6570\u5B57\uFF09");!confirm(`\u65E5\u671F ${e}\uFF0C\u5206\u949F\u6570:${t} ,\u662F\u5426\u786E\u8BA4\u6DFB\u52A0?`)||d.timeRecord.add({date:new Date(e),time:t*60*1e3}).then(()=>{b.value.getData()}).catch(()=>{alert("\u6DFB\u52A0\u5931\u8D25")})}.bind(this),console.log('\u624B\u52A8\u52A0\u8BB0\u5F55\u65B9\u6CD5 addRecord("'+s().format("YYYY-MM-DD 23:30:00")+'")'),window.getTemp=function(){d.tempTimeRecord.toArray().then(e=>console.log(e.reverse()))},console.log("\u83B7\u5F97\u4E34\u65F6\u6570\u636E getTemp()"),window.addBatchTimeData=function(e){function t(l){return Object.prototype.toString.call(l).slice(8,-1).toLowerCase()}if(confirm("\u6DFB\u52A0\u662F\u5426\u6570\u636E\uFF1F")!==!1){console.log(e);for(let l of e){if(t(l.date)!=="date")return console.log("date\u6570\u636E\u4E0D\u5408\u89C4",l),alert("date\u6570\u636E\u4E0D\u5408\u89C4",l);if(t(l.time)!=="number")return console.log("time\u6570\u636E\u4E0D\u5408\u89C4",l),alert("time\u6570\u636E\u4E0D\u5408\u89C4",l)}d.timeRecord.bulkPut(e).then(()=>{alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")}).catch(l=>{console.error("\u65E0\u6CD5\u6DFB\u52A0\u6570\u636E:",l),alert("\u6570\u636E\u6DFB\u52A0\u6210\u529F")})}}},a=()=>{$.value=setInterval(()=>{n()},1e3*60*5)},c=()=>{n(),clearInterval($.value),$.value=null},n=async()=>{let e=v.value;if(o.value===1&&(e+=performance.now()-m.value),e<60*1e3)return;let t={date:new Date().toLocaleString(),time:j(Math.floor(e))};if(M.value!=-1){d.tempTimeRecord.update(M.value,t).then(()=>{}).catch(l=>{console.error("\u6570\u636E\u66F4\u65B0\u5931\u8D25:",l)});return}d.tempTimeRecord.add(t).then(async l=>{M.value=l;try{let N=await d.tempTimeRecord.count(),U=localStorage.getItem("tempTimeLength");U=Number(U)||100;let K=await d.tempTimeRecord.orderBy("id").limit(N-U).primaryKeys();if(K.length===0)return;await d.tempTimeRecord.bulkDelete(K)}catch(N){console.log(N),alert("\u5220\u9664\u81EA\u52A8\u4FDD\u5B58\u4E34\u65F6\u6570\u636E\u5931\u8D25")}}).catch(()=>{alert("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25")})},y=e=>{confirm(r("app.confirmContinue"))!==!1&&(b.value.historyRecords.splice(e.oIdx,1),v.value+=e.time,m.value=performance.now(),d.timeRecord.delete(e.id).then(()=>{b.value.getData()}).catch(t=>{alert(r("app.deleteFailed")+t)}),S())},_=()=>{confirm(r("app.confirmAddTime"))!==!1&&(m.value=performance.now(),v.value+=C.value*1e3*60,v.value=Math.max(0,v.value),S(),C.value=0,oe.success(r("app.addSuccess")))},g=()=>{m.value=performance.now(),S(),z.value=setInterval(S,1e3),o.value=1},w=()=>{v.value+=performance.now()-m.value,m.value=performance.now(),o.value=2,S(),clearInterval(z.value)},H=()=>{clearInterval(z.value),o.value===1&&(v.value+=performance.now()-m.value),d.timeRecord.add({date:new Date,time:Math.floor(v.value)}).then(()=>{m.value=null,f.value="00:00:00",v.value=0,o.value=0,M.value=-1,b.value.getData()}).catch(()=>{alert(r("app.addFailed"))})},S=()=>{f.value=j(performance.now()-m.value+v.value)},j=e=>{e=Math.floor(Math.floor(e)/1e3);const t=Math.floor(e/3600).toString().padStart(2,"0"),l=Math.floor(e%3600/60).toString().padStart(2,"0"),N=(e%60).toString().padStart(2,"0");return`${t}:${l}:${N}`};return te(o,e=>{e===1?a():c()}),ae(()=>{M.value=-1,b.value.getData(),P()}),V({formatTime:j,continueTime:y}),(e,t)=>(D(),I("div",null,[p("section",pe,[p("header",ve,[p("span",{style:L({color:i(x).colorText})},u(e.$t("app.timer")),5),[0,1,2].includes(o.value)?(D(),E(i(le),{key:0,bordered:!1,class:"timer_tag",color:B.value.color},{default:T(()=>[Y(u(B.value.text),1)]),_:1},8,["color"])):A("",!0)]),t[5]||(t[5]=p("hr",{class:"timer_hr"},null,-1)),p("div",{class:"timer_show",style:L({color:i(x).colorText})},u(f.value),5),p("div",fe,[k(i(R),{disabled:!(o.value==0||o.value==2),class:"start",size:"large",type:"primary",onClick:t[0]||(t[0]=l=>g())},{default:T(()=>[Y(u(e.$t("app.start")),1)]),_:1},8,["disabled"]),k(i(R),{disabled:o.value!=1,class:"pause",size:"large",type:"primary",onClick:t[1]||(t[1]=l=>w())},{default:T(()=>[Y(u(e.$t("app.pause")),1)]),_:1},8,["disabled"]),k(i(R),{disabled:!(o.value==1||o.value==2),class:"stop",danger:"",size:"large",onClick:t[2]||(t[2]=l=>H())},{default:T(()=>[Y(u(e.$t("app.stop")),1)]),_:1},8,["disabled"]),o.value==2?(D(),E(i(re),{key:0,style:{width:"120px","margin-left":"30px"},size:"large",type:"number",class:"common_input",value:C.value,"onUpdate:value":t[3]||(t[3]=l=>C.value=l)},null,8,["value"])):A("",!0),o.value==2?(D(),E(i(R),{key:1,class:"",size:"large",onClick:t[4]||(t[4]=l=>_())},{default:T(()=>[Y(u(e.$t("app.addTime")),1)]),_:1})):A("",!0)])]),k(me,{ref_key:"historyListRef",ref:b,formatTime:j,runState:o.value,onContinue:y},null,8,["runState"])]))}},_e=Q(ye,[["__scopeId","data-v-a59367f1"]]);export{_e as default};
